<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这里有点不一样"><title>小程序页面动态配置实现 | 九宫阁</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">小程序页面动态配置实现</h1><a id="logo" href="/.">九宫阁</a><p class="description">大道至简 大象希形</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">小程序页面动态配置实现</h1><div class="post-meta">Feb 3, 2019<span> | </span><span class="category"><a href="/categories/小程序/">小程序</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#功能描述"><span class="toc-number">1.</span> <span class="toc-text">功能描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现方案"><span class="toc-number">2.</span> <span class="toc-text">实现方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#技术栈"><span class="toc-number">3.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码实现"><span class="toc-number">4.</span> <span class="toc-text">代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后端接口"><span class="toc-number">4.1.</span> <span class="toc-text">后端接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理平台"><span class="toc-number">4.2.</span> <span class="toc-text">管理平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小程序"><span class="toc-number">4.3.</span> <span class="toc-text">小程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="post-content"><h2 id="功能描述"><a href="#功能描述" class="headerlink" title="功能描述"></a>功能描述</h2><p>小程序可以根据管理后台配置动态更新展示内容，如实现下面新鲜事栏目图片的来源的可配置，点击跳转url的可配置。</p>
<a id="more"></a>
<p><img src="http://ww1.sinaimg.cn/large/824a2d5dgy1fztoamhznqj20ey0gmgnl.jpg" alt=""></p>
<h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><p>1后端创建一个map结构的数据表，表结构如下：</p>
<p> <img src="http://ww1.sinaimg.cn/large/824a2d5dgy1fztgzjh0swj20mq04g0td.jpg" alt=""></p>
<p>2 管理后台根据不同业务设定不同的key和value，更新数据库</p>
<p>如key：ad1url  value：a.png</p>
<p>如果需要更新页面图片，只需更新ad1url对应的value</p>
<p>3 小程序根据对应业务key获取对应的配置项，更新页面显示</p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><p>后端接口服务：SpringBoot Mybatis MySql</p>
<p>管理后台：vue</p>
<p>前端：小程序</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="后端接口"><a href="#后端接口" class="headerlink" title="后端接口"></a>后端接口</h3><p>为了保证key的唯一性，key在数据库设置为<strong>unique</strong>属性，新增和更新功能通过以下sql语句实现，主要通过<strong>replace into</strong>实现配置项的唯一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert</span>(<span class="string">"&lt;script&gt;"</span>  +</span><br><span class="line">         <span class="string">"REPLACE INTO `rental`.`t_config`(`key`, `value`) VALUES"</span> +</span><br><span class="line">         <span class="string">"&lt;foreach"</span> +</span><br><span class="line">         <span class="string">" collection=\"list\" item=\"item1\" index=\"index\"  separator=\",\"&gt;"</span> +</span><br><span class="line">         <span class="string">"(#&#123;item1.key&#125;, #&#123;item1.value&#125;)"</span> +</span><br><span class="line">         <span class="string">"&lt;/foreach&gt;"</span> +</span><br><span class="line">       <span class="string">"&lt;/script&gt;"</span>)</span><br><span class="line"> <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>, keyProperty = <span class="string">"configId"</span>, keyColumn = <span class="string">"configId"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">long</span> <span class="title">batchInsertOrUpdate</span><span class="params">(List&lt;Config&gt; list)</span></span>;</span><br></pre></td></tr></table></figure>
<p>api设计</p>
<p>一开始想通过传如list数据给后端实现配置项的批量插入功能，发现后端数据一直接受不到，故而退而求其次，通过json字符串实现vue（网络库使用axios）调用后端接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(value = <span class="string">"新增或更新配置列表"</span>)</span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/add_or_update_config_list"</span>, method = RequestMethod.POST, </span><br><span class="line">                produces =    MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseBean&lt;String&gt; <span class="title">addOrUpdateConfigList</span><span class="params">(String list)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> result =  configService.batchInsertOrUpdate(JSONObject.parseArray(</span><br><span class="line">        list,Config.class));</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="管理平台"><a href="#管理平台" class="headerlink" title="管理平台"></a>管理平台</h3><p>管理平台用vue开发，网络框架采用axios，列表数据通过json字符串传递给后端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> config1 = &#123;<span class="attr">key</span>: <span class="string">"ad1Url"</span>, <span class="attr">value</span>: <span class="keyword">this</span>.formData.ad1Url&#125;;</span><br><span class="line"><span class="keyword">let</span> config2 = &#123;<span class="attr">key</span>: <span class="string">"ad2Url"</span>, <span class="attr">value</span>: <span class="keyword">this</span>.formData.ad2Url&#125;;</span><br><span class="line"><span class="keyword">let</span> config3 = &#123;<span class="attr">key</span>: <span class="string">"adClick1"</span>, <span class="attr">value</span>: <span class="keyword">this</span>.formData.adClick1&#125;;</span><br><span class="line"><span class="keyword">let</span> config4 = &#123;<span class="attr">key</span>: <span class="string">"adClick2"</span>, <span class="attr">value</span>: <span class="keyword">this</span>.formData.adClick2&#125;;</span><br><span class="line"><span class="keyword">let</span> configList = [config1, config2, config3, config4];</span><br><span class="line"><span class="keyword">let</span> result = <span class="keyword">await</span> addConfigList(&#123;<span class="attr">list</span>: <span class="built_in">JSON</span>.stringify(configList)&#125;);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h3><p>小程序调用后端接口返回所有配置项，具体业务根据具体业务key获取配置项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">getConfigList: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">    wx.request(&#123;</span><br><span class="line">      url: constant.HOST + <span class="string">'/config/get_config_list'</span>,</span><br><span class="line">      method: <span class="string">'GET'</span>,</span><br><span class="line">      header: &#123;</span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'application/json'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">      &#125;,</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"config list response:"</span> + <span class="built_in">JSON</span>.stringify(res));</span><br><span class="line">        that.setData(&#123; <span class="attr">configList</span>: res.data.data&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;,</span><br><span class="line">     </span><br><span class="line">goAd1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    wx.navigateTo(&#123;</span><br><span class="line">      url: <span class="string">'/pages/webview/webview?url='</span> + <span class="keyword">this</span>.data.configList.adClick1</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个功能我在自己的小程序开发过程中设计的页面配置实现思路，主要遇到了两个小问题：1 如果保证key的唯一性 2 前后端批量数据的传输问题；希望能给遇到同样问题的小伙伴一些启示，如果有更好的方案，欢迎一起讨论</p>
</div><div class="tags"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/">小程序</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/小程序页面动态配置实现/">小程序页面动态配置实现</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">九宫阁.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>